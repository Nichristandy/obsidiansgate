<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Login & User Code</title>
    <!-- Google Fonts - 'Orbitron' for a techy/futuristic look, similar to the image -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Orbitron font and general body styling */
       body {
    font-family: 'Orbitron', sans-serif;
    background-image: url('new-main-background.jpeg'); /* LOGIN PAGE BG */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-color: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
    transition: background-image 1s ease-in-out; /* Smooth change */
}
        /* Custom modal styles for messages */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Slightly increased z-index for absolute certainty */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Slightly darker overlay */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #222; /* Dark background for modal content */
            color: #eee; /* Light text for general messages within modal */
            /* Adding a subtle texture using repeating linear gradient */
            background-image: repeating-linear-gradient(
                45deg,
                rgba(0,0,0,.1) 0px,
                rgba(0,0,0,.1) 1px,
                transparent 1px,
                transparent 5px
            );
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25); /* Slightly stronger shadow */
            max-width: 400px;
            text-align: center;
            position: relative;
            border: 1px solid #444; /* Darker border for dark theme */
        }
        /* Good Side modal aesthetic */
.modal-content.good-side {
    background-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(6px);
    border: 1px solid rgba(255,255,255,0.4);
    box-shadow: 0 0 20px rgba(255,255,255,0.7),
                0 0 50px rgba(200,200,255,0.3);
}

/* Villain modal aesthetic */
.modal-content.villain-side {
    background-color: rgba(30,0,0,0.7);
    border: 1px solid rgba(255,0,0,0.4);
    box-shadow: 0 0 25px rgba(255,0,0,0.6),
                0 0 60px rgba(139,0,0,0.4);
}
        .modal-content .close-button { /* Ensure close button is visible on dark background */
            color: #ddd;
        }
        .modal-content .close-button:hover,
        .modal-content .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        /* Login Section specific styles to match the new design */
        #login-section-container {
    background-color: rgba(0, 0, 0, 0.3); /* Semi-transparent dark */
    backdrop-filter: blur(10px);          /* Glass blur effect */
    -webkit-backdrop-filter: blur(10px);  /* For Safari support */
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle glass border */
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    padding: 40px;
    width: 100%;
    max-width: 450px;
    animation: fadeInScale 0.8s ease-out forwards;
}


        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        #login-section h2 {
            color: #ff3333; /* Red text for headings */
            line-height: 1.3;
            margin-bottom: 1.5rem; /* Adjusted spacing */
            text-shadow: 0 0 8px rgba(255,51,51,0.5); /* Subtle glow */
        }

        #login-section .smaller-text { /* New class for the smaller text */
            font-size: 1rem; /* Adjusted from 2rem (32px) to 24px */
            margin-bottom: 0.5rem; /* Less spacing below it */
        }

        #login-section .larger-text { /* New class for the larger text (VERIFY YOUR IDENTITY) */
            font-size: 2rem; /* Adjusted from 3rem (48px) to 40px */
            margin-bottom: 2rem; /* Ensure good spacing below */
        }

        #login-form label {
            color: #ff3333; /* Red text for labels */
            font-size: 1rem; /* Adjusted from 1.25rem (20px) to 16px */
            text-transform: uppercase; /* Uppercase labels */
            letter-spacing: 0.05em; /* Spaced out letters */
        }

        #login-form input {
            background-color: rgba(0,0,0,0.3); /* Transparent dark input background */
            border: 1px solid #ff3333; /* Red border for inputs */
            color: #eee; /* Light text for input values */
            padding: 0.75rem 1rem; /* Adjusted padding */
            border-radius: 6px; /* Slightly less rounded */
            box-shadow: inset 0 0 5px rgba(255,51,51,0.2); /* Inner glow */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        #login-form input:focus {
            border-color: #ff6666; /* Lighter red on focus */
            box-shadow: inset 0 0 8px rgba(255,102,102,0.4), 0 0 10px rgba(255,102,102,0.6); /* Stronger glow on focus */
            outline: none; /* Remove default outline */
        }

        #login-form button {
            background-color: #ff3333; /* Red button background */
            color: #fff; /* White text on button */
            font-weight: 700; /* Bold font */
            letter-spacing: 0.08em; /* Spaced out letters */
            text-transform: uppercase; /* Uppercase button text */
            border-radius: 8px; /* Rounded corners */
            box-shadow: 0 5px 15px rgba(255,51,51,0.4); /* Red glow shadow */
            transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
        }
        #login-form button:hover {
            background-color: #ff6666; /* Lighter red on hover */
            box-shadow: 0 8px 20px rgba(255,102,102,0.6); /* Stronger glow on hover */
            transform: translateY(-2px); /* Slight lift effect */
        }
        #login-form button:active {
            transform: translateY(0); /* Press down effect */
            box-shadow: 0 2px 5px rgba(255,51,51,0.3);
        }

        @keyframes fadeInUp {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}
/* Glowing text for Good Side */
.glow-good {
    color: white;
    text-shadow: 0 0 10px rgba(255,255,255,0.8),
                 0 0 20px rgba(200,200,255,0.6),
                 0 0 30px rgba(200,200,255,0.5);
}

/* Devilish red glow for Villain */
.glow-villain {
    color: #ff0000;
    text-shadow: 0 0 10px rgba(255,0,0,0.8),
                 0 0 25px rgba(139,0,0,0.6),
                 0 0 35px rgba(100,0,0,0.8);
}

/* Smooth fade-out for modal */
.modal.fade-out {
    opacity: 0;
    transition: opacity 0.8s ease;
}

@keyframes smoothLoginAppear {
    0% {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    60% {
        opacity: 0.8;
        transform: translateY(0) scale(1.02);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Class to trigger the animation */
.login-appear {
    animation: smoothLoginAppear 1.2s ease forwards;
}


    </style>
</head>
<body>

    <!-- Main Container for the entire application -->
     <!-- Entrance Animation Screen -->
<div id="intro-screen" class="fixed inset-0 flex justify-center items-center bg-black text-white text-center z-50">
  <h1 id="intro-text" class="text-xl md:text-3xl leading-relaxed text-center max-w-3xl opacity-0 whitespace-pre-line"></h1>
</div>

    <div id="login-section-container"> <!-- New container for the login form -->
        <!-- Login Section -->
        <div id="login-section">
            <h2 class="font-bold text-center smaller-text">
                THE OBSIDIANS GATE IS LOCKED.<br>ONLY THOSE CLEARED BY HQ MAY PASS.
            </h2>
            <h2 class="font-bold text-center larger-text">
                VERIFY YOUR IDENTITY
            </h2>

            <form id="login-form" class="space-y-5">
                <div>
                    <label for="username" class="block mb-1">USERNAME</label>
                    <input type="text" id="username" name="username" required
                           class="mt-1 block w-full">
                </div>
                <div>
                    <label for="password" class="block mb-1">PASSWORD</label>
                    <input type="password" id="password" name="password" required
                           class="mt-1 block w-full">
                </div>
                <div id="error-message" class="text-red-600 text-sm text-center font-medium hidden"></div>
                <button type="submit" class="w-full flex justify-center py-3 px-4">
                    LOG IN
                </button>
            </form>
        </div>

        <!-- This section is now hidden by default and its content is moved to the modal -->
        <div id="code-display-section" class="hidden"></div>
    </div>

    <!-- Custom Modal for messages and code display -->
    <div id="message-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-modal-button">&times;</span>
            <p id="modal-general-message" class="text-lg font-semibold text-gray-200 mb-4"></p> <!-- Adjusted text color for dark background -->

            <!-- Container for code display within modal -->
            <div id="modal-code-container" class="hidden">
                <p class="text-gray-400 mb-2">You are on the:</p> Adjusted text color for dark background
                <div class="bg-black p-4 rounded-lg shadow-md mb-6">
                    <p id="modal-display-user-code" class="text-red-500 text-2xl font-bold tracking-wider"></p>
                </div>
            </div> 

            <button id="modal-ok-button"
                    class="mt-6 py-2 px-6 bg-stone-700 text-white rounded-lg hover:bg-stone-800 transition duration-200 ease-in-out">
                OK
            </button>
        </div>
    </div>

    <script>

        const roleMessages = {
    good: `Obsidians The Good Side:\nYou made it. One of the few we can trust.\nThe mission starts now.`,
    villain: `You're not Obsidians, but the Villain:\nWelcome, asset. You didn’t choose this.\nBut the syndicate owns you now - The Marionettist`
};


        // --- User Database (JSON) ---
        let users = [];

// Fetch user data from uname.json
fetch('uname2.json')
  .then(response => {
    if (!response.ok) {
      throw new Error('Failed to load user data');
    }
    return response.json();
  })
  .then(data => {
    // Map keys to expected format (username, password, code)
    users = data.map(entry => ({
      username: entry.Username,
      password: entry.Password,
      code: entry.Result,
      role : entry.Roles || 'user' // Default to 'user' if role is not provided
    }));
    console.log("User data loaded successfully:", users);
  })
  .catch(error => {
    console.error("Error loading user data:", error);
    showModal('message', 'Failed to load user data. Please try again later.');
  });

  

        // --- DOM Elements ---
        const loginSection = document.getElementById('login-section');
        const codeDisplaySection = document.getElementById('code-display-section'); // Kept for consistency, but now hidden
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('error-message');

        // Modal elements
        const messageModal = document.getElementById('message-modal');
        const modalGeneralMessage = document.getElementById('modal-general-message'); // Renamed for clarity
        const modalCodeContainer = document.getElementById('modal-code-container'); // New container for code
        const modalDisplayUserCode = document.getElementById('modal-display-user-code'); // New element for code inside modal
        const closeModalButton = document.getElementById('close-modal-button');
        const modalOkButton = document.getElementById('modal-ok-button');

        // --- Utility Functions ---

        /**
         * Displays a custom modal message or code display to the user.
         * @param {string} type - 'message' for general messages, 'code' for displaying user code after login.
         * @param {string} content - The message text (for 'message' type) or username (for 'code' type).
         * @param {string} [code] - The secret code (only required for 'code' type).
         */
        function showModal(type, content, code = '', role = '') {
    // Reset modal state
    modalGeneralMessage.classList.add('hidden');
    modalCodeContainer.classList.add('hidden');

    const modalCard = messageModal.querySelector('.modal-content');
    modalCard.classList.remove('good-side', 'villain-side');
    modalGeneralMessage.classList.remove('glow-good', 'glow-villain');

    if (type === 'message') {
        modalGeneralMessage.textContent = content;
        modalGeneralMessage.classList.remove('hidden');
    } 
    else if (type === 'code') {
        // Determine if this is Good Side or Villain
        const isGood = role.toLowerCase().includes('good');

        // Role-based cinematic messages
        const roleMessages = {
            good: `Obsidians The Good Side:\nYou made it. One of the few we can trust.\nThe mission starts now.`,
            villain: `You're not Obsidians, but the Villain:\nWelcome, asset. You didn’t choose this.\nBut the syndicate owns you now - The Marionettist`
        };

        // Set modal text based on role
        modalGeneralMessage.textContent = isGood ? roleMessages.good : roleMessages.villain;
        modalGeneralMessage.classList.remove('hidden');

        // Apply background + modal/card + glowing text
        if (isGood) {
            document.body.style.backgroundImage = "url('role-background.jpeg')";
            modalCard.classList.add('good-side');
            modalGeneralMessage.classList.add('glow-good');
        } else {
            document.body.style.backgroundImage = "url('role-background.jpeg')";
            modalCard.classList.add('villain-side');
            modalGeneralMessage.classList.add('glow-villain');
        }
    }

    // Show the modal
    messageModal.style.display = 'flex';
}




        /**
         * Hides the custom modal.
         */
       function hideModal(callback) {
    // Add fade-out class
    messageModal.classList.add('fade-out');

    // Wait for animation to finish (0.8s)
    setTimeout(() => {
        messageModal.style.display = 'none';
        messageModal.classList.remove('fade-out'); // Reset for next show
        if (callback) callback(); // Run callback after modal fully hidden
    }, 800);
}


        /**
         * Handles the login process.
         * @param {Event} event - The form submission event.
         */
        function handleLogin(event) {
            event.preventDefault(); // Prevent default form submission

            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            // Find user in our "database"
            const foundUser = users.find(user => user.username === username && user.password === password);
if (foundUser) {
    errorMessage.classList.add('hidden');
    loginSection.classList.add('hidden');
    showModal('code', foundUser.username, '', foundUser.role); // no code shown
}
else {
                // Failed login
                errorMessage.textContent = "Invalid username or password. Please try again.";
                errorMessage.classList.remove('hidden');
                console.log("Login failed. Calling showModal with 'message' type.");
                showModal('message', "Invalid username or password. Please try again.");
            }
        }

    
function handleLogout() {
    document.body.style.transition = 'background-image 1s ease-in-out';
    document.body.style.backgroundImage = "url('new-main-background.jpeg')";

    // Reset modal visuals
    const modalCard = messageModal.querySelector('.modal-content');
    modalCard.classList.remove('good-side', 'villain-side');
    modalGeneralMessage.classList.remove('glow-good', 'glow-villain');

    // Reset login form
    usernameInput.value = '';
    passwordInput.value = '';
    errorMessage.classList.add('hidden');

    // Show login container with the new smooth animation
    loginSection.classList.remove('hidden');
    const loginContainer = document.getElementById('login-section-container');
    loginContainer.style.display = 'block';
    loginContainer.classList.remove('login-appear'); // reset in case it was triggered before

    // Trigger reflow to restart animation
    void loginContainer.offsetWidth;

    loginContainer.classList.add('login-appear');

    console.log("Returned to login form with smooth transition.");
}



// --- Event Listeners ---
loginForm.addEventListener('submit', handleLogin);

closeModalButton.addEventListener('click', () => {
    hideModal(() => {
        handleLogout(); // Return to login after fade-out
    });
});

modalOkButton.addEventListener('click', () => {
    hideModal(() => {
        handleLogout();
    });
});

messageModal.addEventListener('click', (event) => {
    if (event.target === messageModal) {
        hideModal(() => {
            handleLogout();
        });
    }
});




        // Optional: Pre-fill for testing (remove in production)
        // usernameInput.value = "user1";
        // passwordInput.value = "password1";
//         window.addEventListener('DOMContentLoaded', () => {
//     const introScreen = document.getElementById('intro-screen');
//     const introText = document.getElementById('intro-text');
//     const loginContainer = document.getElementById('login-section-container');

//     // Step 1: Animate text in
//     introText.style.animation = 'fadeInUp 1.5s ease forwards';
//     introText.style.opacity = 1;

//     // Step 2: Wait, then transition to login
//     setTimeout(() => {
//         introScreen.style.transition = 'opacity 1s ease';
//         introScreen.style.opacity = 0;

//         setTimeout(() => {
//             introScreen.style.display = 'none';
//             loginContainer.style.opacity = 0;
//             loginContainer.style.display = 'block';
//             loginContainer.style.transition = 'opacity 1s ease';
//             setTimeout(() => {
//                 loginContainer.style.opacity = 1;
//             }, 50);
//         }, 1000);
//     }, 5000); // show intro for 3 seconds
// });

const introTextElement = document.getElementById('intro-text');
const introMessage = `Phase Two has begun. This is the moment when we must face the hard truth, traitors are among us, and not everyone is who they claim to be. 
Trust no one. Loyalties will be tested, and masks will fall. 
The question is: which side are you on?`;

let index = 0;

function typeWriter() {
    if (index < introMessage.length) {
        introTextElement.textContent += introMessage.charAt(index);
        introTextElement.style.opacity = 1; // fade in text as we type
        index++;
        setTimeout(typeWriter, 40); // typing speed in ms (adjust if needed)
    } else {
        // Once typing is done, wait and then fade to login
        setTimeout(() => {
            document.getElementById('intro-screen').style.transition = 'opacity 2.5s ease';
            document.getElementById('intro-screen').style.opacity = 0;

            setTimeout(() => {
                document.getElementById('intro-screen').style.display = 'none';
                const loginContainer = document.getElementById('login-section-container');
                loginContainer.style.opacity = 0;
                loginContainer.style.display = 'block';
                loginContainer.style.transition = 'opacity 2.5s ease';
                setTimeout(() => {
                    loginContainer.style.opacity = 1;
                }, 50);
            }, 1000);
        }, 3000); // Wait 2 seconds after typing ends
    }
}

// Start typing effect when DOM is ready
window.addEventListener('DOMContentLoaded', () => {
    typeWriter();
});


    </script>
</body>
</html>
